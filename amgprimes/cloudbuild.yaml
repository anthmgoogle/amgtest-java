steps:
- name: 'ubuntu'
  entrypoint: 'bash'
  args: ['-c', 'cd amgprimes && pwd']

- name: 'maven:3-jdk-21' # Or another suitable Maven/JDK image
  entrypoint: 'mvn'
  args: ['clean', 'package']

- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'us-west1-docker.pkg.dev/$PROJECT_ID/amgprimes-local/amgprimesapi:latest', '.']

images:
- 'us-west1-docker.pkg.dev/$PROJECT_ID/amgprimes-local/amgprimesapi:latest' # Must match the tag from Step 2


# Optional: Deploy to Cloud Run after a successful build and push
# - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
#   entrypoint: 'gcloud'
#   args: [
#     'run', 'deploy', 'amgprimes-api-service',
#     '--image', 'us-west1-docker.pkg.dev/$PROJECT_ID/amgprimes-local/amgprimesapi:latest',
#     '--region', 'us-west1', # Replace with your Cloud Run service region
#     '--platform', 'managed',
#     '--allow-unauthenticated' # Or --no-allow-unauthenticated based on your setup
#   ]